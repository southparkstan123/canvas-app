<html>

<head>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
        crossorigin="anonymous">
</head>

<body>
    <div class='clearfix container'>
        <div id="canvas-container">
            <canvas id="canvas-real" class="canvas" width='800px' height='500px'></canvas>
            <canvas id="canvas-draft" class="canvas" width='800px' height='500px'></canvas>
        </div>
        <div class="menu">
            <!-- Shape -->
            <button id="drawing-rectangle">Rectangle Tool</button>
            <button id="drawing-line">Pencil Tool</button>
            <button id="drawing-straight-line">Straight Tool</button>
            <button id="drawing-curve">Curve Tool</button>
            <button id="drawing-ellipse">Ellipse Tool</button>
            <button id="drawing-strokerectangle">Stroke Rectangle</button>
            <button id="drawing-polygon">Polygon</button>
            <button id="eyedropper">Eyedropper</button>
            <button id="drawing-random-dots">Random Dots</button>
            <button id="text-tool">Text Tool</button>
            
            <!-- Font -->
            <div class="text-panel">
                <label class="panel1" for="size">Size:</label>
                <select id="size" name="size">
                    <option value = "9" selected>9px</option>
                    <option value = "12">12px</option>
                    <option value = "14">14px</option>
                    <option value = "16">16px</option>
                    <option value = "20">20px</option>
                    <option value = "48">48px</option>
                    <option value = "72">72px</option>
                    <option value = "96">96px</option>
                    <option value = "144">144px</option>
                    <option value = "200">200px</option>
                </select>
            </div>
            <div class="text-panel">
                <label class="panel2" for="fillOrStroke">Fill Or Stroke:</label>
                <select id="fillOrStroke" name="fillOrStroke">
                    <option value = "fill" selected>fill</option>
                    <option value = "stroke">stroke</option>
                </select>
            </div>
            <div class="text-panel">
                <label class="panel3" for="font-family">Font Family:</label>
                <select id="font-family" name="fontFamily">
                    <option value = "Arial" selected>Arial</option>
                    <option value = "Times New Roman">Times New Roman</option>
                </select>
            </div>
            <div class="text-panel">
                <label class="panel4" for="style">Style:</label>
                <select id="style" name="style">
                    <option value = "normal" selected>Normal</option>
                    <option value = "bold">Bold</option>
                    <option value = "italic">Italic</option>
                    <option value = "both">Both</option>
                </select>
            </div>
            <div id="color-panel">
                <div class="selectors">
                    <label class="panel5" for="stroke">Stoke Style:</label>
                    <input type='text' id="strokestyle" />
                </div>
                <div class="selectors">
                    <label class="panel6" for="fill">Fill Style:</label>
                    <input type='text' id="fillstyle" />
                </div>
                <div class="selectors">
                    <label class="panel7" for="background">Background:</label>
                    <input type='text' id="background" />
                </div>
                <div id="linew">
                    <input id="linewidth" type="range" name="linewidth" min="1" max="100">
                </div>
                <div id="line">
                    <select name="LineType" id="linetype">
                        <option value="butt">butt</option>
                        <option value="round">round</option>
                        <option value="square">square</option>
                    </select>
                    <select name="LineJoin" id="linejoin">
                        <option value="miter">miter</option>
                        <option value="round">round</option>
                        <option value="bevel">bevel</option>
                    </select>
                </div>
            </div>
            <!-- action -->
            <button class="btn fa fa-eraser" id="eraser">eraser</button>
            <button class="btn fa fa-undo" id="clear">clear</button>

            <button class="btn fa fa-arrow-left" id="undo">undo</button>
            <button class="btn fa fa-arrow-right" id="redo">redo</button>
            <button class="btn fa fa-cloud-upload" id="upload">upload</button>
        </div>
    </div>

    <script type='text/javascript' src="https://code.jquery.com/jquery-3.2.1.js"></script>

    <script src='scripts/spectrum.js'></script>

    <link rel='stylesheet' href='css/spectrum.css' />
    <link href="css/style.css" rel="stylesheet" type='text/css'>
    <script type='text/javascript' src="scripts/hammer.js"></script>
    <script type='text/javascript' src="scripts/canvas-common.js"></script>
    <script type='text/javascript' src="scripts/drawing-line.js"></script>
    <script type='text/javascript' src="scripts/drawing-ellipse.js"></script>
    <script type='text/javascript' src="scripts/drawing-rectangle.js"></script>
    <script type='text/javascript' src="scripts/drawing-strokerectangle.js"></script>
    <script type='text/javascript' src="scripts/drawing-straight-line.js"></script>
    <script type='text/javascript' src="scripts/drawing-curve.js"></script>
    <script type='text/javascript' src="scripts/drawing-polygon.js"></script>
    <script type='text/javascript' src="scripts/drawing-random-dots.js"></script>
    <script type='text/javascript' src="scripts/drawing-random-line.js"></script>

    <script type='text/javascript' src="scripts/eraser.js"></script>

    <script type='text/javascript' src="scripts/setstrokestyle.js"></script>
    <script type='text/javascript' src="scripts/setfillstyle.js"></script>
    <script type='text/javascript' src="scripts/setbackground.js"></script>

    <script type='text/javascript' src="scripts/eyedropper.js"></script>
    <script type='text/javascript' src="scripts/setlinewidth.js"></script>
    <script type='text/javascript' src="scripts/setlinetype.js"></script>
    <script type='text/javascript' src="scripts/setlinejoin.js"></script>
    <script type='text/javascript' src="scripts/add-text.1.js"></script>
    <script type='text/javascript' src="scripts/firebase-service.js"></script>


    <script src="https://www.gstatic.com/firebasejs/4.6.0/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyCxmdO_MIqagK4DCca_H_WpjCWPuUG_Jfc",
            authDomain: "canvas-app-cc19a.firebaseapp.com",
            databaseURL: "https://canvas-app-cc19a.firebaseio.com",
            projectId: "canvas-app-cc19a",
            storageBucket: "canvas-app-cc19a.appspot.com",
            messagingSenderId: "1068627921931"
        };
        firebase.initializeApp(config);
    </script>


    <script type='text/javascript'>
        $('#drawing-rectangle').click(() => {
            currentFunction = new DrawingRectangle(contextReal, contextDraft);
        });
        $('#drawing-line').click(() => {
            currentFunction = new DrawingLine(contextReal, contextDraft);
        });
        $('#drawing-ellipse').click(() => {
            currentFunction = new DrawingEllipse(contextReal, contextDraft);
        });
        $('#drawing-strokerectangle').click(() => {
            currentFunction = new DrawingStrokeRectangle(contextReal, contextDraft);
        });
        $('#drawing-straight-line').click(() => {
            currentFunction = new DrawingStraightLine(contextReal, contextDraft);
        });
        $('#drawing-curve').click(() => {
            currentFunction = new DrawingCurve(contextReal, contextDraft);
        });
        $('#drawing-polygon').click(() => {
            currentFunction = new DrawingPolygon(contextReal, contextDraft);
        });

        $('#drawing-random-dots').click(() => {
            currentFunction = new DrawingRandomDots(contextReal, contextDraft);
        });

        $('#drawing-random-line').click(() => {
            currentFunction = new DrawingRandomColorLine(contextReal, contextDraft);
        });

        $('#eraser').click(function () {
            currentFunction = new Eraser(contextReal, contextDraft);
        });

        $('#clear').click(() => {
            contextDraft.clearRect(0, 0, canvasDraft.width, canvasDraft.height);
            contextReal.clearRect(0, 0, canvasReal.width, canvasReal.height);
        });

        let undoClicked = false; //first click of Undo


        $('#undo').click(() => {
            var canvasPic = new Image();
            if (undoClicked === false) { //if firstclick needs extra pop
                undoList.pop();
                undoClicked = true; // if not firstclick only needs to pop once so returns true
            }
            if (undoList.length == 0) {  // to clear the canvas when there is no more image stored
                contextReal.clearRect(0, 0, canvasReal.width, canvasReal.height);
                return;
            }
            canvasPic.src = undoList.pop();

            canvasPic.onload = function () {
                contextReal.clearRect(0, 0, canvasReal.width, canvasReal.height);
                contextReal.drawImage(canvasPic, 0, 0);
            }
        });

        $("#text-tool").click(function () {
            currentFunction = new AddText(contextReal, contextDraft);
            currentFunction.reset();
            //Listen the input fields change
            $('select[name="fontFamily"]').change(function (e) {
                currentFunction.onChangeFontFamily(e.target.value);
            })

            $('select[name="fillOrStroke"]').change(function (e) {
                currentFunction.onChangeFillOrStroke(e.target.value);
            })

            $('select[name="style"]').change(function (e) {
                currentFunction.onChangeStyle(e.target.value);
            })

            $('select[name="size"]').change(function (e) {
                currentFunction.onChangeSize(e.target.value);
            })

            $('select[name="lineWidth"]').change(function (e) {
                currentFunction.onChangeLineWidth(e.target.value);
            })

        });

        $(document).ready(function () {
            canvasDraft.width = $('#canvas-container').width();
            canvasDraft.height = $('#canvas-container').height();

            canvasReal.width = $('#canvas-container').width();
            canvasReal.height = $('#canvas-container').height();

        })

        $(window).resize(function () {

            menuwidth = $('.menu').width() ;
            canvasheight = $(window).height() - $('#canvas-container').height();

            var canvasRealx = $(window).width() - menuwidth;
            var canvasRealy = $(window).height() - canvasheight;


            canvasDraft.width = $('#canvas-container').width();
            canvasDraft.height = $('#canvas-container').height();

            canvasReal.width = $('#canvas-container').width();
            canvasReal.height = $('#canvas-container').height();

            let newwidth = $('#canvas-container').width();
            let newheight = $('#canvas-container').height();


            var canvasPic = new Image();
            if (undoList.length == 0) {  // to clear the canvas when there is no more image stored
                return;
            }

            var drawImage = undoList[undoList.length - 1];

            canvasPic.src = drawImage;

            canvasPic.onload = function () {
                contextReal.drawImage(canvasPic, 0, 0); 
            }

        });

        $('#upload').click(()=>{
            let canvasPic = new Image();

            currentFunction = new FirebaseService(canvasReal);
            currentFunction.uploadCanvas();

            if(undoList.length == 0){
                return;
            }
            canvasPic.src = undoList.pop();
            
            canvasPic.onload = function () {
                contextReal.clearRect(0, 0, $('#canvas-container').width(), $('#canvas-container').height());
                contextReal.drawImage(canvasPic, 0, 0); 
            }
        });

        $("#eyedropper").click(function () {
            currentFunction = new EyeDropper(contextReal);
        });

        currentFunction = new DrawingLine(contextReal, contextDraft);
    </script>
</body>

</html>